<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ride Reservation</title>
        <style>
            /* New General Styles */
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                background: #f4f6f8;
                /* Light grey background */
                margin: 0;
                color: #333;
            }

            .container {
                width: 95%;
                max-width: 600px;
                /* Slightly wider container */
                background: #fff;
                padding: 30px;
                /* Adjusted padding for responsiveness */
                border-radius: 15px;
                /* More rounded corners */
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
                /* Softer, larger shadow */
            }

            h2 {
                text-align: center;
                color: #2c3e50;
                /* Darker heading color */
                margin-bottom: 25px;
                /* Adjusted margin */
                font-size: 2em;
                /* Adjusted font size for responsiveness */
            }

            label {
                font-weight: 500;
                /* Slightly lighter but still bold */
                display: block;
                margin-top: 15px;
                /* Adjusted margin */
                margin-bottom: 6px;
                /* Adjusted margin */
                color: #555;
                font-size: 0.95em;
                /* Slightly smaller label for responsiveness */
            }

            select,
            input,
            button {
                width: 100%;
                padding: 12px;
                /* Adjusted padding */
                margin-bottom: 12px;
                /* Adjusted margin */
                border: 1px solid #ddd;
                border-radius: 8px;
                /* More rounded input fields */
                box-sizing: border-box;
                font-size: 1em;
                /* Adjusted font size */
                transition: border-color 0.3s ease;
            }

            select:focus,
            input:focus {
                border-color: #007bff;
                outline: none;
                box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            }

            select {
                appearance: none;
                background: url('data:image/svg+xml;utf8,<svg fill="%23555" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 10px center;
                background-color: #fff;
            }

            .date {
                display: flex;
                gap: 10px;
                margin-bottom: 12px;
            }

            .date>div {
                flex: 1;
            }

            .date label {
                margin-top: 15px;
                /* Adjust label for date/time */
            }

            button {
                background: #007bff;
                color: white;
                font-size: 1.1em;
                /* Adjusted font size */
                border: none;
                cursor: pointer;
                padding: 14px;
                /* Adjusted padding */
                border-radius: 8px;
                margin-top: 20px;
                /* Adjusted margin */
                transition: background 0.3s ease, transform 0.2s ease;
            }

            button:hover {
                background: #0056b3;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            button:active {
                transform: translateY(0);
                box-shadow: none;
            }

            .hidden {
                display: none;
            }

            /* New Spinner */
            .spinner {
                display: flex;
                justify-content: center;
                margin-top: 20px;
            }

            .spinner div {
                width: 10px;
                height: 10px;
                margin: 0 4px;
                background-color: #007bff;
                border-radius: 50%;
                animation: pulse 1.5s infinite ease-in-out;
            }

            .spinner div:nth-child(2) {
                animation-delay: 0.2s;
            }

            .spinner div:nth-child(3) {
                animation-delay: 0.4s;
            }

            @keyframes pulse {

                0%,
                80%,
                100% {
                    transform: scale(0);
                    opacity: 0;
                }

                40% {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            /* New Custom Dropdown */
            .custom-dropdown {
                position: relative;
                width: 100%;
            }

            .custom-dropdown input {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 1em;
                box-sizing: border-box;
            }

            .custom-dropdown .dropdown-list {
                position: absolute;
                width: 100%;
                max-height: 150px;
                overflow-y: auto;
                background: #fff;
                border: 1px solid #ddd;
                border-radius: 8px;
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                display: none;
            }

            .custom-dropdown .dropdown-list div {
                padding: 10px 14px;
                cursor: pointer;
                transition: background 0.2s ease;
            }

            .custom-dropdown .dropdown-list div:hover {
                background: #f8f9fa;
            }

            /* New Vehicle Cards */
            .vehicle-cards {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
                margin-top: 25px;
            }

            .vehicle-card {
                background: #fff;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                text-align: left;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .vehicle-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            }

            .vehicle-card h3 {
                margin-top: 0;
                margin-bottom: 8px;
                font-size: 1.2em;
                color: #2c3e50;
            }

            .vehicle-card p {
                margin-top: 4px;
                margin-bottom: 6px;
                font-size: 0.9em;
                color: #666;
            }

            .vehicle-card .price {
                font-size: 1.4em;
                font-weight: bold;
                color: #007bff;
            }

            /* Total Mileage Display */
            #totalMileageContainer {
                margin-top: 20px;
                padding: 15px;
                background-color: #e9ecef;
                border-radius: 8px;
                text-align: center;
                font-weight: bold;
                color: #495057;
                display: none;
                /* Hidden by default */
            }

            #totalMileage {
                font-size: 1.2em;
                color: #007bff;
            }

            /* Responsive adjustments */
            @media (max-width: 768px) {
                .container {
                    padding: 20px;
                }

                h2 {
                    font-size: 1.8em;
                    margin-bottom: 20px;
                }

                .date {
                    flex-direction: column;
                    /* Stack date and time on smaller screens */
                }

                .date label {
                    margin-top: 15px;
                }
            }
        </style>
    </head>

    <body>

        <div class="container">
            <h2>Ride Reservation</h2>

            <form id="rideForm">
                <label for="serviceType">Service Type</label>
                <select id="serviceType" required>
                    <option value="airport">Airport</option>
                    <option value="city">City</option>
                    <option value="hotel">Hotel</option>
                </select>

                <div class="date">
                    <div>
                        <label for="pickupDate">Pickup Date</label>
                        <input type="date" id="pickupDate" required>
                    </div>
                    <div>
                        <label for="pickupTime">Pickup Time</label>
                        <input type="time" id="pickupTime" required>
                    </div>
                </div>

                <label for="pickupLocation">Pickup Location</label>
                <div class="custom-dropdown">
                    <input type="text" id="pickupLocation" placeholder="Search pickup location" required>
                    <div class="dropdown-list" id="pickupDropdown">
                        <div>New York, NY</div>
                        <div>Los Angeles, CA</div>
                        <div>Chicago, IL</div>
                        <div>Houston, TX</div>
                        <div>Phoenix, AZ</div>
                    </div>
                </div>

                <label for="dropoffLocation">Dropoff Location</label>
                <div class="custom-dropdown">
                    <input type="text" id="dropoffLocation" placeholder="Search dropoff location" required>
                    <div class="dropdown-list" id="dropoffDropdown">
                        <div>New York, NY</div>
                        <div>Los Angeles, CA</div>
                        <div>Chicago, IL</div>
                        <div>Houston, TX</div>
                        <div>Phoenix, AZ</div>
                    </div>
                </div>

                <div class="date">
                    <div>
                        <label for="passengers">Passengers</label>
                        <input type="number" id="passengers" placeholder="Enter number of passengers" min="1" max="10"
                            required>
                    </div>
                    <div>
                        <label for="luggage">Luggage</label>
                        <input type="number" id="luggage" placeholder="Enter number of luggage" min="1" max="10"
                            required>
                    </div>
                </div>

                <button type="submit">Select Vehicle</button>
            </form>

            <div id="loadingSpinner" class="spinner hidden">
                <div></div>
                <div></div>
                <div></div>
            </div>

            <div id="vehicleCards" class="vehicle-cards hidden"></div>

            <div id="totalMileageContainer" class="hidden">
                Total Mileage: <span id="totalMileage"></span>
            </div>
        </div>

        <script>
            // Hide spinner initially on page load
            document.getElementById("loadingSpinner").classList.add("hidden");

            // Dropdown functionality
            const pickupInput = document.getElementById("pickupLocation");
            const pickupDropdown = document.getElementById("pickupDropdown");
            const dropoffInput = document.getElementById("dropoffLocation");
            const dropoffDropdown = document.getElementById("dropoffDropdown");

            pickupInput.addEventListener("input", () => {
                const searchTerm = pickupInput.value.toLowerCase();
                const options = pickupDropdown.querySelectorAll("div");
                options.forEach(option => {
                    if (option.textContent.toLowerCase().includes(searchTerm)) {
                        option.style.display = "block";
                    } else {
                        option.style.display = "none";
                    }
                });
                pickupDropdown.style.display = "block";
            });

            dropoffInput.addEventListener("input", () => {
                const searchTerm = dropoffInput.value.toLowerCase();
                const options = dropoffDropdown.querySelectorAll("div");
                options.forEach(option => {
                    if (option.textContent.toLowerCase().includes(searchTerm)) {
                        option.style.display = "block";
                    } else {
                        option.style.display = "none";
                    }
                });
                dropoffDropdown.style.display = "block";
            });

            document.addEventListener("click", (e) => {
                if (!pickupInput.contains(e.target)) {
                    pickupDropdown.style.display = "none";
                }
                if (!dropoffInput.contains(e.target)) {
                    dropoffDropdown.style.display = "none";
                }
            });

            pickupDropdown.querySelectorAll("div").forEach(option => {
                option.addEventListener("click", () => {
                    pickupInput.value = option.textContent;
                    pickupDropdown.style.display = "none";
                });
            });

            dropoffDropdown.querySelectorAll("div").forEach(option => {
                option.addEventListener("click", () => {
                    dropoffInput.value = option.textContent;
                    dropoffDropdown.style.display = "none";
                });
            });

            // Form submission
            document.getElementById("rideForm").addEventListener("submit", async function (event) {
                event.preventDefault();

                // Show loading spinner and hide vehicle cards
                document.getElementById("loadingSpinner").classList.remove("hidden");
                document.getElementById("vehicleCards").classList.add("hidden");
                document.getElementById("totalMileageContainer").classList.add("hidden"); // Hide mileage initially

                const requestData = {
                    serviceType: document.getElementById("serviceType").value,
                    pickupDate: document.getElementById("pickupDate").value,
                    pickupTime: document.getElementById("pickupTime").value,
                    pickupLocation: document.getElementById("pickupLocation").value,
                    dropoffLocation: document.getElementById("dropoffLocation").value,
                    passengers: parseInt(document.getElementById("passengers").value),
                    luggage: parseInt(document.getElementById("luggage").value)
                };

                try {
                    const response = await fetch("https://ride-reservation.vercel.app/api/rides", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(requestData)
                    });

                    let result;
                    if (response.ok) {
                        result = await response.json();
                    } else {
                        result = { error: await response.text() };
                    }

                    // Hide spinner and display results
                    document.getElementById("loadingSpinner").classList.add("hidden");

                    // Format the response and display all vehicles in cards
                    if (result.error) {
                        document.getElementById("vehicleCards").classList.remove("hidden");
                        document.getElementById("vehicleCards").innerHTML = `<strong style="color:red;">Error:</strong> ${result.error}`;
                        document.getElementById("totalMileageContainer").classList.add("hidden");
                    } else {
                        const vehicles = result.vehicle;
                        let vehicleCardsHTML = '';

                        vehicles.forEach(vehicle => {
                            vehicleCardsHTML += `
                            <div class="vehicle-card">
                                <h3>${vehicle.name} (${vehicle.type})</h3>
                                <p><strong>Seats:</strong> ${vehicle.seats}</p>
                                <p class="price">$${vehicle.price.toFixed(2)}</p>
                            </div>
                        `;
                        });

                        document.getElementById("vehicleCards").classList.remove("hidden");
                        document.getElementById("vehicleCards").innerHTML = vehicleCardsHTML;

                        // Display total mileage if available in the response
                        console.log(`Mileage: ${result.mileage}`);
                        if (result.mileage) {
                            document.getElementById("totalMileage").textContent = `${result.mileage} km`;
                            document.getElementById("totalMileageContainer").classList.remove("hidden");
                        } else {
                            document.getElementById("totalMileageContainer").classList.add("hidden");
                        }
                    }

                } catch (error) {
                    document.getElementById("loadingSpinner").classList.add("hidden");
                    document.getElementById("vehicleCards").classList.remove("hidden");
                    document.getElementById("vehicleCards").innerHTML = `<strong style="color:red;">Error:</strong> ${error.message}`;
                    document.getElementById("totalMileageContainer").classList.add("hidden");
                }
            });
        </script>

    </body>

</html>